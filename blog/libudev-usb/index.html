<!DOCTYPE html>

  <html lang="en-US">
    <head>
      <meta charset="UTF-8"/>

      <meta name="description" content="Below you can find code snippets that match USB devices using libudev.
A good tutorial is available here: libudev and Sysfs Tutorial.
Listing and monitoring USB devices The snippet first prints all detected USB devices, and then enters monitoring mode and prints USB devices when they are inserted or removed.
Source code on GitHub: udev_monitor_usb.c
Example output:
$ ./a.out usb usb_device exists 1d6b:0001 /dev/bus/usb/002/001 usb usb_device exists 046d:c05b /dev/bus/usb/002/002 usb usb_device exists 1d6b:0001 /dev/bus/usb/003/001 usb usb_device exists 1d6b:0001 /dev/bus/usb/004/001 usb usb_device exists 1d6b:0001 /dev/bus/usb/005/001 usb usb_device exists 1d6b:0002 /dev/bus/usb/001/001 usb usb_device add 8564:1000 /dev/bus/usb/001/026 usb usb_device remove 0000:0000 /dev/bus/usb/001/026 ^C  Listing USB storage devices The snippet prints detected USB storage devices."/>
      <meta name="author" content="Victor Gaydov"/>

      <meta property="og:url" content="http://gavv.github.io/blog/libudev-usb/"/>
      <meta property="og:title" content="
  
    Detecting USB devices with libudev
  
"/>
      <meta property="og:description" content="Below you can find code snippets that match USB devices using libudev.
A good tutorial is available here: libudev and Sysfs Tutorial.
Listing and monitoring USB devices The snippet first prints all detected USB devices, and then enters monitoring mode and prints USB devices when they are inserted or removed.
Source code on GitHub: udev_monitor_usb.c
Example output:
$ ./a.out usb usb_device exists 1d6b:0001 /dev/bus/usb/002/001 usb usb_device exists 046d:c05b /dev/bus/usb/002/002 usb usb_device exists 1d6b:0001 /dev/bus/usb/003/001 usb usb_device exists 1d6b:0001 /dev/bus/usb/004/001 usb usb_device exists 1d6b:0001 /dev/bus/usb/005/001 usb usb_device exists 1d6b:0002 /dev/bus/usb/001/001 usb usb_device add 8564:1000 /dev/bus/usb/001/026 usb usb_device remove 0000:0000 /dev/bus/usb/001/026 ^C  Listing USB storage devices The snippet prints detected USB storage devices."/>
      <meta property="og:site_name" content="Victor Gaydov"/>

      <link rel="canonical" href="http://gavv.github.io/blog/libudev-usb/"/>

      <title>
  
    Detecting USB devices with libudev
  
</title>

      <meta name="viewport" content="initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/prism.css"/>
<link rel="stylesheet" href="/css/lightbox.min.css"/>

<link rel="shortcut icon" href="/images/favicon.ico">

<link rel="stylesheet"
      href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">

<link rel="stylesheet"
      href="//fonts.googleapis.com/css?family=Open+Sans|Lustria|Roboto+Mono">

<script src="/js/lightbox-plus-jquery.min.js">
</script>

<script>
    lightbox.option({
      'wrapAround': true,
      'resizeDuration': 0,
      'fadeDuration': 0,
      'imageFadeDuration': 0,
    })
</script>

<script src="/js/prism.js">
</script>

<script>
if (screen && screen.width < 480) {
  document.write('<script src="/js/hyphenator-loader.js"><\/script>');
}
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-93472390-1', 'auto');
  ga('send', 'pageview');
</script>

    </head>
    <body>
      <div id="toplevel">
        <header id="header" class="no-print">
  <div id="caption">
    Victor Gaydov
  </div>
  <div id="menu">
    <div>
      <div>
        <a href="/about/">About</a>
      </div>
    </div>
    <div>
      <div>
        <a href="/projects/">Projects</a>
      </div>
    </div>
    <div>
      <div>
        <a href="/blog/">Blog</a>
      </div>
    </div>
    <div id="header-buttons">
      <div>
        <a href="https://twitter.com/gavv42" class="image-button">
          <i class="fa fa-twitter"></i>
        </a>
        <a href="/index.xml" class="image-button">
          <i class="rss-button fa fa-rss"></i>
        </a>
      </div>
    </div>
  </div>
</header>

        
  <section role="main">
    <article>
      
        
  <header class="post-header">
    <h1 class="post-title">
      
        Detecting USB devices with libudev
      
    </h1>
    <div class="post-time">
      <time datetime="2016-07-05">
        05 Jul 2016
      </time>
    </div>
    <div class="post-tags">
      
      <div class="post-tag">
        <a href="/tags/linux">linux</a>
      </div>
      
      <div class="post-tag">
        <a href="/tags/udev">udev</a>
      </div>
      
      <div class="post-tag">
        <a href="/tags/usb">usb</a>
      </div>
      
    </div>
  </header>


      
      <section>
        

<p>Below you can find code snippets that match USB devices using libudev.</p>

<p>A good tutorial is available here: <a href="http://www.signal11.us/oss/udev/">libudev and Sysfs Tutorial</a>.</p>

<h3 id="listing-and-monitoring-usb-devices">Listing and monitoring USB devices</h3>

<p>The snippet first prints all detected USB devices, and then enters monitoring mode and prints USB devices when they are inserted or removed.</p>

<p>Source code on GitHub: <a href="https://github.com/gavv/snippets/blob/master/udev/udev_monitor_usb.c"><code>udev_monitor_usb.c</code></a></p>

<p>Example output:</p>

<pre><code>$ ./a.out
usb usb_device exists 1d6b:0001 /dev/bus/usb/002/001
usb usb_device exists 046d:c05b /dev/bus/usb/002/002
usb usb_device exists 1d6b:0001 /dev/bus/usb/003/001
usb usb_device exists 1d6b:0001 /dev/bus/usb/004/001
usb usb_device exists 1d6b:0001 /dev/bus/usb/005/001
usb usb_device exists 1d6b:0002 /dev/bus/usb/001/001
usb usb_device    add 8564:1000 /dev/bus/usb/001/026
usb usb_device remove 0000:0000 /dev/bus/usb/001/026
^C
</code></pre>

<h3 id="listing-usb-storage-devices">Listing USB storage devices</h3>

<p>The snippet prints detected USB storage devices.</p>

<p>Storage device is matched with the following criteria:</p>

<ul>
<li>current device SUBSYSTEM is &ldquo;scsi&rdquo; and DEVTYPE is &ldquo;scsi_device&rdquo;</li>
<li>child device exists where SUBSYSTEM is &ldquo;block&rdquo;</li>
<li>child device exists where SUBSYSTEM is &ldquo;scsi_disk&rdquo;</li>
<li>parent device exists where SUBSYSTEM is &ldquo;usb&rdquo; and DEVTYPE is &ldquo;usb_device&rdquo;</li>
</ul>

<p>Source code on GitHub: <a href="https://github.com/gavv/snippets/blob/master/udev/udev_list_usb_storage.c"><code>udev_list_usb_storage.c</code></a>.</p>

<p>Example output:</p>

<pre><code>$ ./a.out
block = /dev/sdb, usb = 0bc2:ab20, scsi = Seagate
</code></pre>

      </section>
    </article>
  </section>
  
    
  <footer id="footer">
    <script>
      $('h2, h3, h4').each(function() {
        var id = $(this).attr('id');
        $(this).prepend(
          '<a class="anchor" href="#' + id +'"><i class="fa fa-paragraph"></i></a>'
        );
      })
    </script>

    <div id="disqus_thread" class="no-print"></div>
    <script>
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//gavv.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Enable JavaScript to view the
        <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>


  

      </div>
    </body>
  </html>

